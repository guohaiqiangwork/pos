<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>收益明细</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/mui.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<script src="js/rem_controle.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			#item1mobile .mui-pull-bottom-tips {
				display: none!important;
			}
			#go_profitlibrary{
				display: none;
			}
		</style>
	</head>

	<body class="bg_white profit_detail">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">收益明细 </h1>
			<a id="go_profitlibrary" class="mui-icon mui-icon-right-nav mui-pull-right" data-href="profit_library_detail.html" style="font-size: .8em;">运营小库明细</a>
		</header>

		<div class="mui-content bg_white">
			<div id="slider" class="mui-slider" style="z-index: inherit;">
				<div id="segmentedControl1" class="bank_tab mui-segmented-control bg_white">
					<a id="" class="mui-control-item mui-active" href="#item1mobile">我的明细</a>
					<a id="getPartnerLowerCustomerDetailList" class="mui-control-item" href="#item2mobile">代理明细</a>
				</div>

				<div class="line"></div>

				<div id="mui-content-padded" class="mui-content-padded bg_white" style="margin: 0;">
					<!--我的明细-->
					<div id="item1mobile" class="mui-control-content mui-active">
						<div id="slider" class="mui-slider" style="z-index: inherit;">
							<div id="segmentedControl2" class="bank_tab mui-segmented-control bg_white">
								<a id="getPartnerDistributionDetail" class="mui-control-item mui-active" href="#item3mobile"><span>分销明细</span></a>
								<a id="getPartnerOthersPayType" class="mui-control-item" href="#item4mobile"><span>其他支付</span></a>
							</div>

							<div class="mui-content-padded bg_white" style="margin: 0;">
								<!--分销明细-->
								<div id="item3mobile" class="mui-control-content mui-active">
									<!--<div class="library_content">
										<div class="left">
											<div class="library_content_name">分销费</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>200.00</span>元</div>
									</div>
									<div class="library_content">
										<div class="left">
											<div class="library_content_name">激活费</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>80.00</span>元</div>
									</div>
									<div class="library_content">
										<div class="left">
											<div class="library_content_name">分润<span class="subname">交易<span>2000.00</span>元</span>
											</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>100.00</span>元</div>
									</div>
									<div class="library_content">
										<div class="left">
											<div class="library_content_name">分润<span class="subname">交易<span>2000.00</span>元</span>
											</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>100.00</span>元</div>
									</div>
									<div class="library_content">
										<div class="left">
											<div class="library_content_name">分润<span class="subname">交易<span>2000.00</span>元</span>
											</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>100.00</span>元</div>
									</div>
									<div class="library_content">
										<div class="left">
											<div class="library_content_name">公司分红</div>
											<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
										<div class="library_content_right">+<span>100.00</span>元</div>
									</div>-->
								</div>
								<!--其它支付-->
								<div id="item4mobile" class="mui-control-content">
									<!--<div class="my_profit bg_white">
										<div class="my_profit_title">
											<div class="mark_pay"><img class="img" src="img/icon_profit_vip.png" alt="" /></div>
											<div class="my_profit_pay_name">VIP云闪付</div>
											<div class="my_profit_pay_date right">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>

										<div class="my_pay_detail overflow">
											<div class="pay_detail_left left">
												<div class="library_content_name">交易额：<span>1600.00</span>元</div>
												<div class="library_content_name">分润：<span>2000.00</span>元</div>
											</div>

											<div class="pay_detail_right left">+<span>200.00</span>元</div>
										</div>
									</div>
									<div class="my_profit bg_white">
										<div class="my_profit_title">
											<div class="mark_pay"><img class="img" src="img/icon_profit_activate.png" alt="" /></div>
											<div class="my_profit_pay_name">激活费</div>
											<div class="my_profit_pay_date right">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
									
										<div class="my_pay_detail overflow">
											<div class="pay_detail_left left">
												<div class="library_content_name">机具编号：zfhhh0000123456</div>
											</div>
											<div class="pay_detail_right left">+<span>200.00</span>元</div>
										</div>
									</div>
									<div class="my_profit bg_white">
										<div class="my_profit_title">
											<div class="mark_pay"><img class="img" src="img/icon_profit_vip1.png" alt="" /></div>
											<div class="my_profit_pay_name">VIP刷卡支付</div>
											<div class="my_profit_pay_date right">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
									
										<div class="my_pay_detail overflow">
											<div class="pay_detail_left left">
												<div class="library_content_name">交易额：<span>1600.00</span>元</div>
												<div class="library_content_name">分润：<span>2000.00</span>元</div>
											</div>
									
											<div class="pay_detail_right left">+<span>200.00</span>元</div>
										</div>
									</div>
									<div class="my_profit bg_white">
										<div class="my_profit_title">
											<div class="mark_pay"><img class="img" src="img/icon_profit_cloud.png" alt="" /></div>
											<div class="my_profit_pay_name">云闪付</div>
											<div class="my_profit_pay_date right">2018-07-23&nbsp;&nbsp;21:47:01</div>
										</div>
									
										<div class="my_pay_detail overflow">
											<div class="pay_detail_left left">
												<div class="library_content_name">交易额：<span>1600.00</span>元</div>
												<div class="library_content_name">分润：<span>2000.00</span>元</div>
											</div>
											<div class="pay_detail_right left">+<span>300.00</span>元</div>
										</div>
									</div>-->
								</div>
							</div>
						</div>
					</div>
					<!--代理明细-->
					<div id="item2mobile" class="mui-control-content">
						<!--<div class="library_content">
							<div class="left">
								<div class="library_content_name">二级分销费</div>
								<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
							</div>
							<div class="library_content_right">+200.00元</div>
						</div>
						<div class="library_content">
							<div class="left">
								<div class="library_content_name">二级分润<span class="subname">交易2000.00元</span></div>
								<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
							</div>
							<div class="library_content_right">+80.00元</div>
						</div>
						<div class="library_content">
							<div class="left">
								<div class="library_content_name">三级分润<span class="subname">交易2000.00元</span></div>
								<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
							</div>
							<div class="library_content_right">+100.00元</div>
						</div>
						<div class="library_content">
							<div class="left">
								<div class="library_content_name">三级分销费</div>
								<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
							</div>
							<div class="library_content_right">+100.00元</div>
						</div>
						<div class="library_content">
							<div class="left">
								<div class="library_content_name">其他分销费</div>
								<div class="library_content_date">2018-07-23&nbsp;&nbsp;21:47:01</div>
							</div>
							<div class="library_content_right">+100.00元</div>
						</div>-->
					</div>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/myStorage.js"></script>
		<script src="js/custom.js"></script>
		<script src="js/mui.pullToRefresh.js"></script>
		<script src="js/mui.pullToRefresh.material.js"></script>
		<script type="text/javascript">
			mui.init();
			var starttime = "",
				endtime = "";
			// H5 plus事件处理
			function plusReady() {
				// 设置系统状态栏背景色，颜色
				plus.navigator.setStatusBarBackground('#078ffe');
				plus.navigator.setStatusBarStyle('light');
				starttime = myStorage.getItem('profit_time')[0];
				endtime = myStorage.getItem('profit_time')[1];
			}
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}
			//选项卡切换
			var state = 2,
				tab_id = "item3mobile",
				pageNo = 1,
				flag = true;
			//加载更多初始化
			mui('#mui-content-padded').pullToRefresh({
				up: {
					callback: function() {
						var _this = this;
						console.log(this)
						setTimeout(function() {
							console.log(flag)
							if(flag) {
								if("item3mobile" == tab_id) {
									getPartnerDistributionDetail();
								} else if("item2mobile" == tab_id) {
									getPartnerLowerCustomerDetailList();
								}else if("item4mobile" == tab_id){
									getPartnerOthersPayType();
								}
							}
							_this.endPullUpToRefresh(!flag);
						}, 500);
					}
				}
			});
			//切换选项卡
			mui('body').on('tap', 'a', function(e) {
				pageNo = 1;
				flag = true;
				if("getPartnerDistributionDetail" == this.id) {
					tab_id = "item3mobile";
					$("#item3mobile").html("");
					getPartnerDistributionDetail();
				} else if("getPartnerOthersPayType" == this.id) {
					tab_id = "item3mobile";
					$("#item4mobile").html("");
					getPartnerOthersPayType();
				} else if("getPartnerLowerCustomerDetailList" == this.id) {
					tab_id = "item2mobile";
					$("#item2mobile").html("");
					getPartnerLowerCustomerDetailList();
				} else {
					tab_id = "item3mobile";
					$("#item3mobile").html("");
					getPartnerDistributionDetail();
				}
//				mui('.mui-content-padded').pullToRefresh().refresh(true);
			});
			mui('body').on('tap', '#go_profitlibrary', function(e) {
				location.href = this.dataset.href
			});
			//时间范围
			if(null!=myStorage.getItem('profit_time')[0]){
				starttime = myStorage.getItem('profit_time')[0];
				endtime = myStorage.getItem('profit_time')[1];
			}
			console.log(starttime, endtime)
			
			var key = getQueryString("key");
			if(key == "tab02") {
				$(".mui-control-item").eq(0).removeClass("mui-active")
				$(".mui-control-item").eq(1).addClass("mui-active")
				tab_id = "item2mobile";
				$("#item1mobile").removeClass("mui-active");
				$("#item2mobile").addClass("mui-active");
				$("#item2mobile").html("");
				getPartnerLowerCustomerDetailList();
			}else{
				getPartnerDistributionDetail();
			}
			
			//获取分销明细列表
			function getPartnerDistributionDetail() {
				mui.ajax(ajax_url + 'appCustomer/getPartnerDistributionDetail', {
					data: {
						"model.customer_id": customerId,
						"model.startTime": starttime,
						"model.endTime": endtime,
						"model.pos_type": '1',
						"page.pageNo": pageNo
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						if(true == data.success) {
							if(0 == data.obj.results.length) {
								flag = data.obj.haveNextPage;
								var listnone = '<div class="list-none" style="display:block">' +
									'<img class="icon_none icon_none_mt" src="img/icon_none_address.png">' +
									'<div class="fonts">空空如也</div>' +
									'</div>';
								$("#item3mobile").append(listnone);
								$(".mui-pull-bottom-tips").hide();
							} else {
								if(data.obj.totalRecord > 10) {
									$(".mui-pull-bottom-tips").show();
								} else {
									$(".mui-pull-bottom-tips").hide();
								}
								//是否有下一页
								pageNo++;
								flag = data.obj.haveNextPage;
								var results = data.obj.results;
								for(var i = 0; i < results.length; i++) {
									console.log(results[i])
									//1：刷卡记录，2：激活机具记录,3推荐费记录，4分红记录
									if(1 == results[i].type) {
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">分润<span class="subname">交易<span>' + results[i].tradeAmt + '</span>元</span>' +
											'</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item3mobile").append(library_content);
									} else if(2 == results[i].type) {
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">激活费</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item3mobile").append(library_content);
									} else if(3 == results[i].type) {
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">分销费</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item3mobile").append(library_content);
									} else if(4 == results[i].type) {
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">公司分红</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item3mobile").append(library_content);
									}
								}
							}
						}
						if(false == data.success) {
							mui.toast(data.msg)
						}
					},
					error: function(xhr, type, errorThrown) {
						if(xhr.status != '0')
							mui.toast('服务器走丢了')
					}
				});
			}
			//获取合伙人其他支付方式列表
			function getPartnerOthersPayType() {
				mui.ajax(ajax_url + 'appCustomer/getPartnerOthersPayType', {
					data: {
						"model.customer_id": customerId,
						"model.type":2,
						"model.startTime": starttime,
						"model.endTime": endtime,
						"model.pos_type": '1',
						"page.pageNo": pageNo
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						if(true == data.success) {
							console.log(data)
							if(0 == data.obj.results.length) {
								flag = data.obj.haveNextPage;
								var listnone = '<div class="list-none" style="display:block">' +
									'<img class="icon_none icon_none_mt" src="img/icon_none_address.png">' +
									'<div class="fonts">空空如也</div>' +
									'</div>';
								$("#item4mobile").append(listnone);
								$(".mui-pull-bottom-tips").hide();
							} else {
								if(data.obj.totalRecord > 10) {
									$(".mui-pull-bottom-tips").show();
								} else {
									$(".mui-pull-bottom-tips").hide();
								}
								//是否有下一页
								pageNo++;
								flag = data.obj.haveNextPage;
								var results = data.obj.results;
								for(var i = 0; i < results.length; i++) {
									console.log(results[i])
									//1：刷卡记录，2：激活机具记录,3推荐费记录，4分红记录
									if(1 == results[i].type) {
										//1001-刷卡支付收款 1002-微信支付收款 1010-支付宝支付收款 1013-云闪付支付收款 2001-取现* 1014-银联二维码 1015-快捷支付
										if(1013 == results[i].tradeType && 1 == results[i].isVipTrade) {
											var library_content = '<div class="my_profit bg_white">' +
												'<div class="my_profit_title">' +
												'<div class="mark_pay"><img class="img" src="img/icon_profit_vip.png" alt="" /></div>' +
												'<div class="my_profit_pay_name">VIP云闪付</div>' +
												'<div class="my_profit_pay_date right">' + timestampToTime(results[i].createTime) + '</div>' +
												'</div>' +
												'<div class="my_pay_detail overflow">' +
												'<div class="pay_detail_left left">' +
												'<div class="library_content_name">交易额：<span>' + results[i].tradeAmt + '</span>元</div>' +
												'<div class="library_content_name">分润：<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'<div class="pay_detail_right left">+<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'</div>';
											$("#item4mobile").append(library_content);
										} else if(1013 == results[i].tradeType && 2 == results[i].isVipTrade) {
											var library_content = '<div class="my_profit bg_white">' +
												'<div class="my_profit_title">' +
												'<div class="mark_pay"><img class="img" src="img/icon_profit_cloud.png" alt="" /></div>' +
												'<div class="my_profit_pay_name">云闪付</div>' +
												'<div class="my_profit_pay_date right">' + timestampToTime(results[i].createTime) + '</div>' +
												'</div>' +
												'<div class="my_pay_detail overflow">' +
												'<div class="pay_detail_left left">' +
												'<div class="library_content_name">交易额：<span>' + results[i].tradeAmt + '</span>元</div>' +
												'<div class="library_content_name">分润：<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'<div class="pay_detail_right left">+<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'</div>';
											$("#item4mobile").append(library_content);
										} else if(1001 == results[i].tradeType && 1 == results[i].isVipTrade) {
											var library_content = '<div class="my_profit bg_white">' +
												'<div class="my_profit_title">' +
												'<div class="mark_pay"><img class="img" src="img/icon_profit_vip1.png" alt="" /></div>' +
												'<div class="my_profit_pay_name">VIP刷卡支付</div>' +
												'<div class="my_profit_pay_date right">' + timestampToTime(results[i].createTime) + '</div>' +
												'</div>' +
												'<div class="my_pay_detail overflow">' +
												'<div class="pay_detail_left left">' +
												'<div class="library_content_name">交易额：<span>' + results[i].tradeAmt + '</span>元</div>' +
												'<div class="library_content_name">分润：<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'<div class="pay_detail_right left">+<span>' + results[i].money + '</span>元</div>' +
												'</div>' +
												'</div>';
											$("#item4mobile").append(library_content);
										}
									} else if(2 == results[i].type) {
										var library_content = '<div class="my_profit bg_white">' +
											'<div class="my_profit_title">' +
											'<div class="mark_pay"><img class="img" src="img/icon_profit_activate.png" alt="" /></div>' +
											'<div class="my_profit_pay_name">激活费</div>' +
											'<div class="my_profit_pay_date right">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="my_pay_detail overflow">' +
											'<div class="pay_detail_left left">' +
											'<div class="library_content_name">机具编号：<span>' + results[i].posCode + '</span></div>' +
											'</div>' +
											'<div class="pay_detail_right left">+<span>' + results[i].money + '</span>元</div>' +
											'</div>' +
											'</div>';
										$("#item4mobile").append(library_content);
									}
								}
							}
						}
						if(false == data.success) {
							mui.toast(data.msg)
						}
					},
					error: function(xhr, type, errorThrown) {
						if(xhr.status != '0')
							mui.toast('服务器走丢了')
					}
				});
			}
			//获取合伙人下级代理给上级代理的明细收益
			function getPartnerLowerCustomerDetailList() {
				mui.ajax(ajax_url + 'appCustomer/getPartnerLowerCustomerDetailList', {
					data: {
						"model.customer_id": customerId,
						"model.startTime": starttime,
						"model.endTime": endtime,
						"model.pos_type": '1',
						"page.pageNo": pageNo
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						if(true == data.success) {
							console.log(data.obj.results.length)
							if(0 == data.obj.results.length) {
								flag = data.obj.haveNextPage;
								var listnone = '<div class="list-none" style="display:block">' +
									'<img class="icon_none icon_none_mt" src="img/icon_none_address.png">' +
									'<div class="fonts">空空如也</div>' +
									'</div>';
								$("#item2mobile").append(listnone);
								$(".mui-pull-bottom-tips").hide();
							} else {
								if(data.obj.totalRecord > 10) {
									$(".mui-pull-bottom-tips").show();
								} else {
									$(".mui-pull-bottom-tips").hide();
								}
								//是否有下一页
								pageNo++;
								flag = data.obj.haveNextPage;
								var results = data.obj.results;
								for(var i = 0; i < results.length; i++) {
									console.log(results[i])
									if(1==results[i].type && 2==results[i].ratioLevel){
										//二级分润
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">二级分润</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item2mobile").append(library_content);
									}else if(1==results[i].type && 3==results[i].ratioLevel){
										//三级分润
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">三级分润</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item2mobile").append(library_content);
									}else if(2==results[i].type && 3==results[i].level){
										//三级分销费
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">三级分销费</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item2mobile").append(library_content);
									}else if(2==results[i].type && 4==results[i].level){
										//其他分销费
										var library_content = '<div class="library_content">' +
											'<div class="left">' +
											'<div class="library_content_name">其他分销费</div>' +
											'<div class="library_content_date">' + timestampToTime(results[i].createTime) + '</div>' +
											'</div>' +
											'<div class="library_content_right">+<span>' + results[i].money + '</span>元</div>' +
											'</div>';
										$("#item2mobile").append(library_content);
									}
								}
							}
						}
						if(false == data.success) {
							mui.toast(data.msg)
						}
					},
					error: function(xhr, type, errorThrown) {
						if(xhr.status != '0')
							mui.toast('服务器走丢了')
					}
				});
			}
			//判断会员是不是运营小库
			validatorReportCenterExistByCustomer();
			function validatorReportCenterExistByCustomer() {
				mui.ajax(ajax_url + 'appCustomer/validatorReportCenterExistByCustomer', {
					data: {
						customerId: customerId
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						if(true == data.success) {
							if(true == data.obj) {
								$("#go_profitlibrary").show();
							} else {
								$("#go_profitlibrary").hide();
							}
						}
						if(false == data.success) {
							mui.toast("会员信息不明确")
						}
					},
					error: function(xhr, type, errorThrown) {
						if(xhr.status != '0')
							mui.toast('服务器走丢了')
					}
				});
			}
		</script>
	</body>

</html>